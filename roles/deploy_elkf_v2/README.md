# Role to deploy ELKF Stack V2

Роль раскатывает на хосты из inventory указанное количество сервисов стека в зависимости от свободной памяти на хостах.

## TODO
- [x] Какая-то дичь с дефолтами, переделать ([commit 8f6d766](https://github.com/deathjoin/ansible-elkf/commit/8f6d76600315413d696700b84a859f9eb1d4a43a))

## Работа роли
1. [x] Определить с какими параметрами стартуем
2. [x] Понять, какие ноды из кластера уже работают на хостах, чтобы не считать память под них (хорошо подумать)
3. [x] Рассчитать на какой хост что будем катить в зависимости от памяти 
4. [x] Рассчитать порты и endpoint'ы кластера Elastic
5. [x] Задеплоить кластер Elastic по значениям из hostvars
6. [x] Убить лишние Elactic-контейнеры, которые возможно остались от прошлого деплоя
7. [ ] Задеплоить Kibana
8. [ ] Задеплоить Остальное
9. [ ] Убить все контейнеры, которые лишние
10. [x] Проверить healthcheck кластера Elastic

## Запуск плейбука
```bash
ansible-playbook -i environments/prod -e "elastic=2 kibana=1"  playbooks/install-elkf.yml 
```

```bash
# запуск с количеством контейнеров 0 (по-умолчанию) удалит все контейнеры кластера с хостов
ansible-playbook -i environments/prod playbooks/install-elkf.yml
```