# Role to deploy ELKF Stack V2

Роль раскатывает на хосты из inventory указанное количество сервисов стека в зависимости от свободной памяти на хостах.

## Схема работы роли:
1. Узнать, работают ли уже какие-нибудь контейнеры стека на хостах
2. Рассчитать на какой хост и что будем катить с учетом свободной памяти и уже запущенных контейнеров
3. Рассчитать для каждого контейнера необходимые параметры: имя, порты, discovery для elastic и другое
4. Прописать в hostvars данные для каждого контейнера на своём хосте
5. Спулить образа
6. Запустить контейнеры
7. Удалить лишние контейнеры, если они остались с прошлого деплоя
8. Проверить healthcheck кластера ElasticSearch

## Запуск плейбука
```bash
ansible-playbook -i environments/prod -e "elastic=2 kibana=1"  playbooks/install-elkf.yml 
```

```bash
# запуск с количеством контейнеров 0 (по-умолчанию) удалит все контейнеры кластера с хостов
ansible-playbook -i environments/prod playbooks/install-elkf.yml
```