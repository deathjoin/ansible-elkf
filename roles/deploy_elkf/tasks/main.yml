- name: Find current host services
  set_fact:
    # stack version
    elkf_stack_version: "{{ elkf_stack.version | default(elkf_default_version) }}"
    # services for current host
    elkf_host_services: "{{ 
      elkf_stack['hosts_configuration'] | 
      selectattr('host_inventory_name', 'equalto', inventory_hostname) | 
      map(attribute='services') |
      flatten
      }}"

- name: Create docker network for ELKF
  docker_network:
    name: "{{ elkf_stack.network | default(elkf_default_network_name) }}"
    labels: "{{ elkf_group_label }}"

- name: "Run ELKF Containers: ElasticSearch"
  import_tasks: run_elasticsearch.yml

- name: "Run ELKF Containers: Kibana"\
  import_tasks: run_kibana.yml