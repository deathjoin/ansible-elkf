- name: Create docker network for ELKF
  docker_network:
    name: "{{ elkf_network_name }}"

- name: "Pull ELKF images: Version {{ elkf_version }}"
  docker_image:
    name: "{{ item.image }}"
    tag: "{{ elkf_version }}"
    source: pull
  loop: "{{ elkf_containers }}"

- name: Remove previous ELKF Containers
  docker_container:
    name: "{{ item.image.split('/')[-1] }}"
    state: absent
  loop: "{{ elkf_containers }}"

- name: Put Kibana config
  copy:
    src: kibana.yml
    dest: /etc/kibana.yml

- name: "Run ELKF Containers: Version {{ elkf_version }}"
  docker_container:
    name: "{{ item.image.split('/')[-1] }}"
    image: "{{ item.image }}:{{ elkf_version }}"
    ports: "{{ item.ports }}"
    env: "{{ item.environment }}"
    networks:
      - name: "{{ elkf_network_name }}"
        aliases:
          - "{{ item.image.split('/')[-1] }}"
  loop: "{{ elkf_containers }}"